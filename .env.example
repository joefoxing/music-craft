# Music Cover Generator Configuration
# Copy this file to .env and fill in your values

# Flask Configuration
FLASK_DEBUG=True
SECRET_KEY=your-secret-key-here-change-in-production
HOST=0.0.0.0
PORT=5000

# Kie API Configuration
KIE_API_KEY=your-kie-api-key-here
# Get your API key from: https://kie.ai/api-key
USE_MOCK=false  # Set to true for testing without real API calls

# Application Configuration
BASE_URL=http://localhost:5000
MAX_CONTENT_LENGTH=20971520  # 20MB in bytes

# Database configuration (PostgreSQL)
# DATABASE_URL=postgresql://postgres:password@localhost:5432/music_cover_generator
# For development, you can use SQLite:
DATABASE_URL=sqlite:///app.db

# Email configuration (for verification and password reset)
# For Gmail, you need to:
# 1. Enable 2-factor authentication
# 2. Generate an app-specific password: https://myaccount.google.com/apppasswords
# 3. Use that password here (not your regular Gmail password)
MAIL_SERVER=smtp.gmail.com
MAIL_PORT=587
MAIL_USE_TLS=true
MAIL_USERNAME=your-email@gmail.com
MAIL_PASSWORD=your-app-password
MAIL_DEFAULT_SENDER=your-email@gmail.com

# Stripe / Billing
# Create products and prices at https://dashboard.stripe.com/products
STRIPE_SECRET_KEY=sk_test_...
STRIPE_PUBLISHABLE_KEY=pk_test_...
STRIPE_WEBHOOK_SECRET=whsec_...
# Pro Creator: $15/mo recurring
STRIPE_PRO_MONTHLY_PRICE_ID=price_...
# Pro Creator: $144/yr recurring (20% off)
STRIPE_PRO_ANNUAL_PRICE_ID=price_...
# Token Pack: one-time purchase (e.g. 100 tokens / $5)
STRIPE_TOKEN_PACK_PRICE_ID=price_...

# PayPal / Billing (Alternative payment method)
# Get credentials from: https://developer.paypal.com/dashboard/
# Client ID and Secret from your app (Sandbox or Live)
PAYPAL_CLIENT_ID=your-paypal-client-id-here
PAYPAL_CLIENT_SECRET=your-paypal-client-secret-here
# Set to 'sandbox' for testing, 'live' for production
PAYPAL_MODE=sandbox
# Webhook ID for receiving PayPal events
PAYPAL_WEBHOOK_ID=your-paypal-webhook-id-here

# Security configuration
LOGIN_RATE_LIMIT=5 per minute
REGISTER_RATE_LIMIT=3 per hour
PASSWORD_RESET_RATE_LIMIT=2 per hour

# OAuth configuration
OAUTH_ENABLED=false
GOOGLE_OAUTH_CLIENT_ID=your-google-client-id-here
GOOGLE_OAUTH_CLIENT_SECRET=your-google-client-secret-here
GITHUB_OAUTH_CLIENT_ID=your-github-client-id-here
GITHUB_OAUTH_CLIENT_SECRET=your-github-client-secret-here

# File hosting configuration
USE_PUBLIC_HOSTING=true
PUBLIC_BASE_URL=https://drive.google.com/

# Audio processing
FFMPEG_PATH=/usr/bin/ffmpeg
AUTO_CONVERT_AUDIO=true
TARGET_AUDIO_FORMAT=mp3
TARGET_BITRATE=128k
TARGET_SAMPLE_RATE=44100

# Lyrics extraction
LYRICS_EXTRACTION_ENABLED=true
LYRICS_WHISPER_MODEL=base
# Optional fallback model used when primary result quality is poor
LYRICS_WHISPER_FALLBACK_MODEL=small
# Optional (example: en, vi, ja)
LYRICS_WHISPER_LANGUAGE=
# Whisper decoding quality controls
LYRICS_WHISPER_TEMPERATURE=0
LYRICS_WHISPER_BEAM_SIZE=5
LYRICS_WHISPER_BEST_OF=5
LYRICS_WHISPER_PATIENCE=1.0
LYRICS_WHISPER_CONDITION_ON_PREVIOUS_TEXT=false
LYRICS_WHISPER_COMPRESSION_RATIO_THRESHOLD=2.2
LYRICS_WHISPER_LOGPROB_THRESHOLD=-1.0
LYRICS_WHISPER_NO_SPEECH_THRESHOLD=0.6
# Enforce original-language output (reject translation-like output when language is specified, e.g. vi)
LYRICS_ENFORCE_ORIGINAL_LANGUAGE=true
# Optional JSON dictionary for custom Vietnamese typo fixes.
# Example: {"dọng nói":"giọng nói","lời bay hát":"lời bài hát"}
LYRICS_VI_CUSTOM_CORRECTIONS_JSON=
# If false, skip fallback model when it is heavier than primary and not already cached
LYRICS_ALLOW_UNCACHED_HEAVIER_FALLBACK=false
# Enable to run Demucs vocal stem separation before Whisper transcription
LYRICS_VOCAL_SEPARATION_ENABLED=false
# If true, automatically retries with vocal separation when output quality is poor
LYRICS_AUTO_RETRY_WITH_VOCAL_SEPARATION=false
# Repetition/quality filters
LYRICS_MIN_UNIQUE_WORD_RATIO=0.22
LYRICS_MAX_REPEATED_NGRAM_RATIO=0.08
LYRICS_MAX_SAME_CHUNK_REPEATS=2
# Maximum downloaded remote audio size for extraction
LYRICS_MAX_DOWNLOAD_MB=30
# Queue extraction in background instead of blocking add-to-library API
LYRICS_EXTRACTION_ASYNC_ENABLED=true
# In-process worker count for async extraction
LYRICS_EXTRACTION_WORKERS=2

# ===== Lyrics Microservice Configuration (NEW) =====
# Enable microservice mode (recommended for production)
LYRICS_USE_MICROSERVICE=false
# Microservice URL (when LYRICS_USE_MICROSERVICE=true)
LYRICS_MICROSERVICE_URL=http://localhost:8000/v1
# Microservice timeout (in seconds)
LYRICS_MICROSERVICE_TIMEOUT=600
# Poll interval for checking job status (in seconds)
LYRICS_MICROSERVICE_POLL_INTERVAL=2

# ===== OpenAI Whisper API Configuration =====
# Get your API key from: https://platform.openai.com/api-keys
OPENAI_API_KEY=your-openai-api-key-here
# Use OpenAI's cloud Whisper API (fast, ~10-30s) instead of local processing (~6-7 min)
LYRICS_USE_OPENAI_API=true

# ===== Multi-Tier Lyrics Strategy =====
# Tier 2: LRCLIB (free, no API key required)
LYRICS_USE_LRCLIB=true

# Enhanced LRCLIB Configuration
LYRICS_USE_ENHANCED_LRCLIB=true            # Use enhanced client with caching and fuzzy matching
LRCLIB_MIN_MATCH_SCORE=50.0                # Minimum confidence score (0-100) for accepting results
LRCLIB_USE_SYNCED_LYRICS=false             # Parse synced lyrics (LRC format) to plain text

# Lyrics Caching Configuration  
LYRICS_CACHE_ENABLED=true                  # Enable persistent caching of LRCLIB results
LYRICS_CACHE_TTL_DAYS=30                   # Cache expiry in days

# Tier 3: AssemblyAI (requires API key)
# Get your API key from: https://www.assemblyai.com/dashboard/signup
# Free tier: 185 hours/month of transcription
ASSEMBLYAI_API_KEY=your-assemblyai-api-key-here
LYRICS_USE_ASSEMBLYAI=true

# Genius API – used by the Tier 3 lyrics pipeline (Genius + syncedlyrics)
# Get a free token at: https://genius.com/api-clients
GENIUS_ACCESS_TOKEN=your-genius-access-token-here

