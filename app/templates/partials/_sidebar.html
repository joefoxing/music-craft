<!-- SideNavBar - Enhanced Modern Design -->
<aside id="main-sidebar" class="sidebar-panel w-[85vw] max-w-[300px] lg:w-72 flex-shrink-0 flex flex-col border-r border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 z-30 hidden lg:flex shadow-xl">
    <!-- Logo Section -->
    <div class="p-7 flex items-center gap-4 border-b border-slate-100 dark:border-slate-800">
        <a href="/dashboard" class="flex items-center gap-4 flex-1 min-w-0 group">
            <div class="bg-gradient-to-br from-fuchsia-600 to-pink-600 aspect-square rounded-xl size-12 flex items-center justify-center shadow-lg shadow-fuchsia-600/30 flex-shrink-0 group-hover:shadow-fuchsia-600/50 transition-shadow">
                <span class="material-symbols-outlined text-white text-2xl" style="font-variation-settings: 'FILL' 1;">graphic_eq</span>
            </div>
            <div class="flex-1 min-w-0">
                <h1 class="text-2xl font-black tracking-tight bg-gradient-to-r from-fuchsia-600 to-pink-500 bg-clip-text text-transparent dark:from-fuchsia-400 dark:to-pink-400">AudioCraft</h1>
                <p class="text-xs text-slate-500 dark:text-slate-400 mt-0.5">Music Creation Studio</p>
            </div>
        </a>
        <button id="sidebar-collapse-btn" title="Collapse sidebar"
            class="p-1.5 rounded-lg text-slate-400 hover:text-primary hover:bg-primary/10 transition-colors flex-shrink-0">
            <span class="material-symbols-outlined text-lg" id="sidebar-collapse-icon">chevron_left</span>
        </button>
    </div>
    
    <!-- Main Navigation -->
    <nav class="flex-1 flex flex-col gap-2 p-5">
        <!-- Dashboard Link with Dropdown Menu -->
        <div class="relative">
            <div class="flex items-center justify-between">
                <button id="dashboard-main-btn" class="flex items-center gap-4 px-5 py-3.5 rounded-xl transition-all duration-300 flex-1 text-left {% if active_nav == 'dashboard' or active_nav == 'history' or active_nav == 'library' %}bg-primary/5 dark:bg-primary/10 text-primary border-l-4 border-primary shadow-sm{% else %}text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white hover:translate-x-1 hover:shadow-md{% endif %}">
                    <span class="material-symbols-outlined text-xl {% if active_nav == 'dashboard' or active_nav == 'history' or active_nav == 'library' %}text-primary{% else %}text-slate-500 dark:text-slate-400{% endif %}" {% if active_nav == 'dashboard' or active_nav == 'history' or active_nav == 'library' %}style="font-variation-settings: 'FILL' 1;"{% endif %}>dashboard</span>
                    <span class="text-sm font-semibold {% if active_nav == 'dashboard' or active_nav == 'history' or active_nav == 'library' %}font-bold{% endif %}">Dashboard</span>
                </button>
                <button id="dashboard-menu-btn" class="p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors ml-2" aria-label="Dashboard menu">
                    <span class="material-symbols-outlined text-lg text-slate-500 dark:text-slate-400">more_vert</span>
                </button>
            </div>
            
            <!-- Dropdown Menu -->
            <div id="dashboard-dropdown" class="hidden absolute left-0 top-full mt-2 w-56 bg-white dark:bg-slate-800 rounded-xl shadow-lg border border-slate-200 dark:border-slate-700 z-50">
                <div class="py-2">
                    <!-- Dashboard Link -->
                    <a class="flex items-center gap-4 px-4 py-3 text-sm text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 hover:text-slate-900 dark:hover:text-white transition-colors" href="/dashboard">
                        <span class="material-symbols-outlined text-lg {% if active_nav == 'dashboard' %}text-primary{% else %}text-slate-500 dark:text-slate-400{% endif %}" {% if active_nav == 'dashboard' %}style="font-variation-settings: 'FILL' 1;"{% endif %}>dashboard</span>
                        <span class="font-medium {% if active_nav == 'dashboard' %}font-bold text-primary{% endif %}">Dashboard</span>
                    </a>
                    
                    <!-- History Link -->
                    <a class="flex items-center gap-4 px-4 py-3 text-sm text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 hover:text-slate-900 dark:hover:text-white transition-colors" href="/history">
                        <span class="material-symbols-outlined text-lg {% if active_nav == 'history' %}text-primary{% else %}text-slate-500 dark:text-slate-400{% endif %}" {% if active_nav == 'history' %}style="font-variation-settings: 'FILL' 1;"{% endif %}>library_music</span>
                        <span class="font-medium {% if active_nav == 'history' %}font-bold text-primary{% endif %}">History</span>
                    </a>
                    
                    <!-- Library Link -->
                    <a class="flex items-center gap-4 px-4 py-3 text-sm text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 hover:text-slate-900 dark:hover:text-white transition-colors" href="/library">
                        <span class="material-symbols-outlined text-lg {% if active_nav == 'library' %}text-primary{% else %}text-slate-500 dark:text-slate-400{% endif %}" {% if active_nav == 'library' %}style="font-variation-settings: 'FILL' 1;"{% endif %}>explore</span>
                        <span class="font-medium {% if active_nav == 'library' %}font-bold text-primary{% endif %}">Library</span>
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Create Link with Dropdown Menu -->
        <div class="relative">
            <div class="flex items-center justify-between">
                <button id="create-main-btn" class="flex items-center gap-4 px-5 py-3.5 rounded-xl transition-all duration-300 flex-1 text-left {% if active_nav == 'music-generator' or active_nav == 'cover-generator' %}bg-primary/5 dark:bg-primary/10 text-primary border-l-4 border-primary shadow-sm{% else %}text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white hover:translate-x-1 hover:shadow-md{% endif %}">
                    <span class="material-symbols-outlined text-xl {% if active_nav == 'music-generator' or active_nav == 'cover-generator' %}text-primary{% else %}text-slate-500 dark:text-slate-400{% endif %}" {% if active_nav == 'music-generator' or active_nav == 'cover-generator' %}style="font-variation-settings: 'FILL' 1;"{% endif %}>add_circle</span>
                    <span class="text-sm font-semibold {% if active_nav == 'music-generator' or active_nav == 'cover-generator' %}font-bold{% endif %}">Create</span>
                </button>
                <button id="create-menu-btn" class="p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors ml-2" aria-label="Create menu">
                    <span class="material-symbols-outlined text-lg text-slate-500 dark:text-slate-400">more_vert</span>
                </button>
            </div>

            <!-- Dropdown Menu -->
            <div id="create-dropdown" class="hidden absolute left-0 top-full mt-2 w-56 bg-white dark:bg-slate-800 rounded-xl shadow-lg border border-slate-200 dark:border-slate-700 z-50">
                <div class="py-2">
                    <!-- Music Link -->
                    <a class="flex items-center gap-4 px-4 py-3 text-sm text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 hover:text-slate-900 dark:hover:text-white transition-colors" href="/music-generator">
                        <span class="material-symbols-outlined text-lg {% if active_nav == 'music-generator' %}text-primary{% else %}text-slate-500 dark:text-slate-400{% endif %}" {% if active_nav == 'music-generator' %}style="font-variation-settings: 'FILL' 1;"{% endif %}>add_circle</span>
                        <span class="font-medium {% if active_nav == 'music-generator' %}font-bold text-primary{% endif %}">Music</span>
                    </a>

                    <!-- Cover Link -->
                    <a class="flex items-center gap-4 px-4 py-3 text-sm text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 hover:text-slate-900 dark:hover:text-white transition-colors" href="/cover-generator">
                        <span class="material-symbols-outlined text-lg {% if active_nav == 'cover-generator' %}text-primary{% else %}text-slate-500 dark:text-slate-400{% endif %}" {% if active_nav == 'cover-generator' %}style="font-variation-settings: 'FILL' 1;"{% endif %}>graphic_eq</span>
                        <span class="font-medium {% if active_nav == 'cover-generator' %}font-bold text-primary{% endif %}">Cover</span>
                    </a>
                </div>
            </div>
        </div>
        
        {% if current_user.is_authenticated and current_user.has_permission('view_admin') %}
        <a class="flex items-center gap-4 px-5 py-3.5 rounded-xl transition-all duration-300 {% if active_nav == 'admin' %}bg-primary/5 dark:bg-primary/10 text-primary border-l-4 border-primary shadow-sm{% else %}text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white hover:translate-x-1 hover:shadow-md{% endif %}" href="/admin">
            <span class="material-symbols-outlined text-xl {% if active_nav == 'admin' %}text-primary{% else %}text-slate-500 dark:text-slate-400{% endif %}" {% if active_nav == 'admin' %}style="font-variation-settings: 'FILL' 1;"{% endif %}>admin_panel_settings</span>
            <span class="text-sm font-semibold {% if active_nav == 'admin' %}font-bold{% endif %}">Admin</span>
        </a>
        {% endif %}
        
        <!-- Add/Remove Link with Dropdown Menu -->
        <div class="relative">
            <div class="flex items-center justify-between">
                <button id="addremove-main-btn" class="flex items-center gap-4 px-5 py-3.5 rounded-xl transition-all duration-300 flex-1 text-left {% if active_nav == 'add-instrumental' or active_nav == 'add-vocal' or active_nav == 'vocal-removal' %}bg-primary/5 dark:bg-primary/10 text-primary border-l-4 border-primary shadow-sm{% else %}text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white hover:translate-x-1 hover:shadow-md{% endif %}">
                    <span class="material-symbols-outlined text-xl {% if active_nav == 'add-instrumental' or active_nav == 'add-vocal' or active_nav == 'vocal-removal' %}text-primary{% else %}text-slate-500 dark:text-slate-400{% endif %}" {% if active_nav == 'add-instrumental' or active_nav == 'add-vocal' or active_nav == 'vocal-removal' %}style="font-variation-settings: 'FILL' 1;"{% endif %}>edit</span>
                    <span class="text-sm font-semibold {% if active_nav == 'add-instrumental' or active_nav == 'add-vocal' or active_nav == 'vocal-removal' %}font-bold{% endif %}">Add/Remove</span>
                </button>
                <button id="addremove-menu-btn" class="p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors ml-2" aria-label="Add/Remove menu">
                    <span class="material-symbols-outlined text-lg text-slate-500 dark:text-slate-400">more_vert</span>
                </button>
            </div>
            
            <!-- Dropdown Menu -->
            <div id="addremove-dropdown" class="hidden absolute left-0 top-full mt-2 w-56 bg-white dark:bg-slate-800 rounded-xl shadow-lg border border-slate-200 dark:border-slate-700 z-50">
                <div class="py-2">
                    <!-- Add Instrumental Link -->
                    <a class="flex items-center gap-4 px-4 py-3 text-sm text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 hover:text-slate-900 dark:hover:text-white transition-colors" href="/add-instrumental">
                        <span class="material-symbols-outlined text-lg {% if active_nav == 'add-instrumental' %}text-primary{% else %}text-slate-500 dark:text-slate-400{% endif %}" {% if active_nav == 'add-instrumental' %}style="font-variation-settings: 'FILL' 1;"{% endif %}>library_add</span>
                        <span class="font-medium {% if active_nav == 'add-instrumental' %}font-bold text-primary{% endif %}">Add Instrumental</span>
                    </a>
                    
                    <!-- Add Vocal Link -->
                    <a class="flex items-center gap-4 px-4 py-3 text-sm text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 hover:text-slate-900 dark:hover:text-white transition-colors" href="/add-vocal">
                        <span class="material-symbols-outlined text-lg {% if active_nav == 'add-vocal' %}text-primary{% else %}text-slate-500 dark:text-slate-400{% endif %}" {% if active_nav == 'add-vocal' %}style="font-variation-settings: 'FILL' 1;"{% endif %}>record_voice_over</span>
                        <span class="font-medium {% if active_nav == 'add-vocal' %}font-bold text-primary{% endif %}">Add Vocal</span>
                    </a>
                    
                    <!-- Remove Vocal Link -->
                    <a class="flex items-center gap-4 px-4 py-3 text-sm text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 hover:text-slate-900 dark:hover:text-white transition-colors" href="/vocal-removal">
                        <span class="material-symbols-outlined text-lg {% if active_nav == 'vocal-removal' %}text-primary{% else %}text-slate-500 dark:text-slate-400{% endif %}" {% if active_nav == 'vocal-removal' %}style="font-variation-settings: 'FILL' 1;"{% endif %}>cut</span>
                        <span class="font-medium {% if active_nav == 'vocal-removal' %}font-bold text-primary{% endif %}">Remove Vocal</span>
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Divider -->
        <div class="h-px bg-gradient-to-r from-transparent via-slate-200 to-transparent dark:via-slate-700 my-6 mx-5"></div>
        
        <!-- Playlists Section - Dynamic Component -->
        <div id="your-playlists-container" class="px-5 py-3 flex-shrink-0 min-h-0">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-widest sidebar-playlists-title">Your Playlists</h3>
                <a href="/library" class="sidebar-playlists-view-all text-xs text-primary hover:text-primary-dark font-medium opacity-0 transition-opacity duration-200" aria-label="View all playlists">
                    View all
                </a>
            </div>
            
            <!-- Loading State - Skeleton -->
            <div id="playlists-loading" class="flex flex-col gap-3" role="status" aria-label="Loading playlists">
                <div class="flex items-center gap-3.5 px-3 py-2.5">
                    <div class="w-[60px] h-[60px] rounded-lg bg-slate-200 dark:bg-slate-700 animate-pulse flex-shrink-0"></div>
                    <div class="flex-1 min-w-0 space-y-2">
                        <div class="h-4 bg-slate-200 dark:bg-slate-700 rounded animate-pulse w-3/4"></div>
                        <div class="h-3 bg-slate-200 dark:bg-slate-700 rounded animate-pulse w-1/2"></div>
                    </div>
                </div>
                <div class="flex items-center gap-3.5 px-3 py-2.5">
                    <div class="w-[60px] h-[60px] rounded-lg bg-slate-200 dark:bg-slate-700 animate-pulse flex-shrink-0"></div>
                    <div class="flex-1 min-w-0 space-y-2">
                        <div class="h-4 bg-slate-200 dark:bg-slate-700 rounded animate-pulse w-2/3"></div>
                        <div class="h-3 bg-slate-200 dark:bg-slate-700 rounded animate-pulse w-1/3"></div>
                    </div>
                </div>
                <div class="flex items-center gap-3.5 px-3 py-2.5">
                    <div class="w-[60px] h-[60px] rounded-lg bg-slate-200 dark:bg-slate-700 animate-pulse flex-shrink-0"></div>
                    <div class="flex-1 min-w-0 space-y-2">
                        <div class="h-4 bg-slate-200 dark:bg-slate-700 rounded animate-pulse w-4/5"></div>
                        <div class="h-3 bg-slate-200 dark:bg-slate-700 rounded animate-pulse w-1/2"></div>
                    </div>
                </div>
            </div>
            
            <!-- Empty State -->
            <div id="playlists-empty" class="hidden flex flex-col items-center justify-center py-6 text-center" role="status" aria-label="No playlists found">
                <span class="material-symbols-outlined text-4xl text-slate-300 dark:text-slate-600 mb-3">playlist_add</span>
                <p class="text-sm text-slate-500 dark:text-slate-400 mb-3">No playlists yet</p>
                <a href="/library" class="inline-flex items-center gap-2 px-4 py-2 bg-primary hover:bg-primary-dark text-white text-sm font-medium rounded-lg transition-colors">
                    <span class="material-symbols-outlined text-base">add</span>
                    Create your first playlist
                </a>
            </div>
            
            <!-- Error State -->
            <div id="playlists-error" class="hidden flex flex-col items-center justify-center py-6 text-center" role="alert" aria-label="Error loading playlists">
                <span class="material-symbols-outlined text-4xl text-red-400 dark:text-red-500 mb-3">error_outline</span>
                <p class="text-sm text-slate-600 dark:text-slate-400 mb-3">Failed to load playlists</p>
                <button id="playlists-retry-btn" class="inline-flex items-center gap-2 px-4 py-2 bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-700 dark:text-slate-300 text-sm font-medium rounded-lg transition-colors">
                    <span class="material-symbols-outlined text-base">refresh</span>
                    Retry
                </button>
            </div>
            
            <!-- Playlists List -->
            <ul id="playlists-list" class="hidden flex flex-col gap-2" role="list" aria-label="List of recent playlists">
                <!-- Playlist items will be dynamically inserted here -->
            </ul>
            
            <!-- Compact View for Mobile/Icon-only mode -->
            <ul id="playlists-list-compact" class="hidden flex-col gap-2" role="list" aria-label="List of recent playlists">
                <!-- Compact playlist items will be dynamically inserted here -->
            </ul>
        </div>
    </nav>
    
    <!-- Bottom Section -->
    <div class="p-6 border-t border-slate-200 dark:border-slate-800 bg-gradient-to-t from-slate-50 to-white dark:from-slate-900 dark:to-slate-950">
        <!-- Upgrade Button -->
        <button class="flex w-full items-center justify-center gap-3 rounded-xl py-3.5 px-5 bg-gradient-to-r from-fuchsia-600 to-pink-600 hover:from-fuchsia-700 hover:to-pink-700 transition-all duration-300 shadow-lg shadow-fuchsia-600/30 hover:shadow-fuchsia-600/50 mb-6 group">
            <span class="material-symbols-outlined text-white text-lg group-hover:scale-110 transition-transform">diamond</span>
            <span class="text-white text-sm font-bold">Upgrade to Pro</span>
        </button>
        
        <!-- User Section -->
        <div class="flex items-center gap-4">
            {% if current_user.is_authenticated %}
            <!-- Authenticated User -->
            <div class="bg-gradient-to-br from-fuchsia-500 to-pink-600 rounded-full size-12 flex items-center justify-center shadow-lg ring-2 ring-white/20 dark:ring-slate-800/50" data-alt="User avatar">
                <span class="material-symbols-outlined text-white text-lg">person</span>
            </div>
            <div class="flex flex-col overflow-hidden flex-1">
                <p class="text-slate-900 dark:text-white text-sm font-semibold truncate">{{ current_user.display_name or current_user.email }}</p>
                <p class="text-slate-500 dark:text-slate-400 text-xs truncate">
                    {% if current_user.email_verified %}
                    <span class="text-green-600 dark:text-green-400 font-medium">âœ“ Verified</span>
                    {% else %}
                    <span class="text-amber-600 dark:text-amber-400 font-medium">Unverified</span>
                    {% endif %}
                </p>
            </div>
            <a href="{{ url_for('auth.profile') }}" class="text-slate-500 dark:text-slate-400 hover:text-primary dark:hover:text-primary transition-colors" title="Profile">
                <span class="material-symbols-outlined text-lg">settings</span>
            </a>
            {% else %}
            <!-- Not Authenticated -->
            <div class="bg-gradient-to-br from-slate-400 to-slate-500 rounded-full size-12 flex items-center justify-center shadow-lg ring-2 ring-white/20 dark:ring-slate-800/50">
                <span class="material-symbols-outlined text-white text-lg">person</span>
            </div>
            <div class="flex flex-col overflow-hidden flex-1">
                <p class="text-slate-900 dark:text-white text-sm font-semibold truncate">Guest User</p>
                <p class="text-slate-500 dark:text-slate-400 text-xs truncate">Not signed in</p>
            </div>
            <div class="flex gap-2">
                <a href="{{ url_for('auth.login') }}" class="text-xs text-primary hover:text-primary-dark font-semibold px-3 py-1.5 rounded-lg hover:bg-primary/10 transition-colors">Login</a>
                <a href="{{ url_for('auth.register') }}" class="text-xs bg-primary hover:bg-primary-dark text-white font-semibold px-3 py-1.5 rounded-lg transition-colors">Register</a>
            </div>
            {% endif %}
        </div>
        
        {% if current_user.is_authenticated %}
        <div class="mt-5 pt-4 border-t border-slate-200 dark:border-slate-800">
            <a href="{{ url_for('auth.logout') }}" class="flex items-center gap-3 text-sm text-slate-600 dark:text-slate-400 hover:text-red-600 dark:hover:text-red-400 transition-colors px-3 py-2 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 group">
                <span class="material-symbols-outlined text-base group-hover:scale-110 transition-transform">logout</span>
                <span class="font-medium">Logout</span>
            </a>
        </div>
        {% endif %}
    </div>
</aside>
<script src="{{ url_for('static', filename='js/sidebar.js') }}" defer></script>