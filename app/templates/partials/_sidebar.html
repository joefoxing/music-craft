<!-- SideNavBar - Enhanced Modern Design -->
<aside id="main-sidebar" class="sidebar-panel w-[85vw] max-w-[300px] lg:w-72 flex-shrink-0 flex flex-col border-r border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 z-30 hidden lg:flex shadow-xl">
    <!-- Logo Section -->
    <div class="p-7 flex items-center gap-4 border-b border-slate-100 dark:border-slate-800">
        <div class="bg-gradient-to-br from-indigo-500 to-purple-600 aspect-square rounded-xl size-12 flex items-center justify-center shadow-lg shadow-indigo-500/30">
            <span class="material-symbols-outlined text-white text-2xl" style="font-variation-settings: 'FILL' 1;">graphic_eq</span>
        </div>
        <div>
            <h1 class="text-2xl font-black tracking-tight bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent dark:from-indigo-400 dark:to-purple-400">AudioCraft</h1>
            <p class="text-xs text-slate-500 dark:text-slate-400 mt-0.5">Music Creation Studio</p>
        </div>
    </div>
    
    <!-- Main Navigation -->
    <nav class="flex-1 flex flex-col gap-2 p-5">
        <!-- Dashboard Link -->
        <a class="flex items-center gap-4 px-5 py-3.5 rounded-xl transition-all duration-300 {% if active_nav == 'dashboard' %}bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 text-indigo-600 dark:text-indigo-300 border-l-4 border-indigo-500 shadow-sm{% else %}text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white hover:translate-x-1 hover:shadow-md{% endif %}" href="/">
            <span class="material-symbols-outlined text-xl {% if active_nav == 'dashboard' %}text-indigo-600 dark:text-indigo-300{% else %}text-slate-500 dark:text-slate-400{% endif %}" {% if active_nav == 'dashboard' %}style="font-variation-settings: 'FILL' 1;"{% endif %}>dashboard</span>
            <span class="text-sm font-semibold {% if active_nav == 'dashboard' %}font-bold{% endif %}">Dashboard</span>
        </a>
        
        <!-- Music Generator Link -->
        <a class="flex items-center gap-4 px-5 py-3.5 rounded-xl transition-all duration-300 {% if active_nav == 'music-generator' %}bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 text-indigo-600 dark:text-indigo-300 border-l-4 border-indigo-500 shadow-sm{% else %}text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white hover:translate-x-1 hover:shadow-md{% endif %}" href="/music-generator">
            <span class="material-symbols-outlined text-xl {% if active_nav == 'music-generator' %}text-indigo-600 dark:text-indigo-300{% else %}text-slate-500 dark:text-slate-400{% endif %}" {% if active_nav == 'music-generator' %}style="font-variation-settings: 'FILL' 1;"{% endif %}>add_circle</span>
            <span class="text-sm font-semibold {% if active_nav == 'music-generator' %}font-bold{% endif %}">Music Generator</span>
        </a>
        
        <!-- Cover Generator Link -->
        <a class="flex items-center gap-4 px-5 py-3.5 rounded-xl transition-all duration-300 {% if active_nav == 'cover-generator' %}bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 text-indigo-600 dark:text-indigo-300 border-l-4 border-indigo-500 shadow-sm{% else %}text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white hover:translate-x-1 hover:shadow-md{% endif %}" href="/cover-generator">
            <span class="material-symbols-outlined text-xl {% if active_nav == 'cover-generator' %}text-indigo-600 dark:text-indigo-300{% else %}text-slate-500 dark:text-slate-400{% endif %}" {% if active_nav == 'cover-generator' %}style="font-variation-settings: 'FILL' 1;"{% endif %}>graphic_eq</span>
            <span class="text-sm font-semibold {% if active_nav == 'cover-generator' %}font-bold{% endif %}">Cover Generator</span>
        </a>
        
        <!-- History Link -->
        <a class="flex items-center gap-4 px-5 py-3.5 rounded-xl transition-all duration-300 {% if active_nav == 'history' %}bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 text-indigo-600 dark:text-indigo-300 border-l-4 border-indigo-500 shadow-sm{% else %}text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white hover:translate-x-1 hover:shadow-md{% endif %}" href="/history">
            <span class="material-symbols-outlined text-xl {% if active_nav == 'history' %}text-indigo-600 dark:text-indigo-300{% else %}text-slate-500 dark:text-slate-400{% endif %}" {% if active_nav == 'history' %}style="font-variation-settings: 'FILL' 1;"{% endif %}>library_music</span>
            <span class="text-sm font-semibold {% if active_nav == 'history' %}font-bold{% endif %}">History</span>
        </a>
        
        <!-- Library Link -->
        <a class="flex items-center gap-4 px-5 py-3.5 rounded-xl transition-all duration-300 {% if active_nav == 'library' %}bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 text-indigo-600 dark:text-indigo-300 border-l-4 border-indigo-500 shadow-sm{% else %}text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white hover:translate-x-1 hover:shadow-md{% endif %}" href="/library">
            <span class="material-symbols-outlined text-xl {% if active_nav == 'library' %}text-indigo-600 dark:text-indigo-300{% else %}text-slate-500 dark:text-slate-400{% endif %}" {% if active_nav == 'library' %}style="font-variation-settings: 'FILL' 1;"{% endif %}>explore</span>
            <span class="text-sm font-semibold {% if active_nav == 'library' %}font-bold{% endif %}">Library</span>
        </a>

        {% if current_user.is_authenticated and current_user.has_permission('view_admin') %}
        <a class="flex items-center gap-4 px-5 py-3.5 rounded-xl transition-all duration-300 {% if active_nav == 'admin' %}bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 text-indigo-600 dark:text-indigo-300 border-l-4 border-indigo-500 shadow-sm{% else %}text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white hover:translate-x-1 hover:shadow-md{% endif %}" href="/admin">
            <span class="material-symbols-outlined text-xl {% if active_nav == 'admin' %}text-indigo-600 dark:text-indigo-300{% else %}text-slate-500 dark:text-slate-400{% endif %}" {% if active_nav == 'admin' %}style="font-variation-settings: 'FILL' 1;"{% endif %}>admin_panel_settings</span>
            <span class="text-sm font-semibold {% if active_nav == 'admin' %}font-bold{% endif %}">Admin</span>
        </a>
        {% endif %}
        
        <!-- Add Instrumental Link -->
        <a class="flex items-center gap-4 px-5 py-3.5 rounded-xl transition-all duration-300 {% if active_nav == 'add-instrumental' %}bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 text-indigo-600 dark:text-indigo-300 border-l-4 border-indigo-500 shadow-sm{% else %}text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white hover:translate-x-1 hover:shadow-md{% endif %}" href="/add-instrumental">
            <span class="material-symbols-outlined text-xl {% if active_nav == 'add-instrumental' %}text-indigo-600 dark:text-indigo-300{% else %}text-slate-500 dark:text-slate-400{% endif %}" {% if active_nav == 'add-instrumental' %}style="font-variation-settings: 'FILL' 1;"{% endif %}>library_add</span>
            <span class="text-sm font-semibold {% if active_nav == 'add-instrumental' %}font-bold{% endif %}">Add Instrumental</span>
        </a>
        
        <!-- Add Vocal Link -->
        <a class="flex items-center gap-4 px-5 py-3.5 rounded-xl transition-all duration-300 {% if active_nav == 'add-vocal' %}bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 text-indigo-600 dark:text-indigo-300 border-l-4 border-indigo-500 shadow-sm{% else %}text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white hover:translate-x-1 hover:shadow-md{% endif %}" href="/add-vocal">
            <span class="material-symbols-outlined text-xl {% if active_nav == 'add-vocal' %}text-indigo-600 dark:text-indigo-300{% else %}text-slate-500 dark:text-slate-400{% endif %}" {% if active_nav == 'add-vocal' %}style="font-variation-settings: 'FILL' 1;"{% endif %}>record_voice_over</span>
            <span class="text-sm font-semibold {% if active_nav == 'add-vocal' %}font-bold{% endif %}">Add Vocal</span>
        </a>

        <!-- Voice Conversion Link -->
        <a class="flex items-center gap-4 px-5 py-3.5 rounded-xl transition-all duration-300 {% if active_nav == 'voice-conversion' %}bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 text-indigo-600 dark:text-indigo-300 border-l-4 border-indigo-500 shadow-sm{% else %}text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white hover:translate-x-1 hover:shadow-md{% endif %}" href="/voice">
            <span class="material-symbols-outlined text-xl {% if active_nav == 'voice-conversion' %}text-indigo-600 dark:text-indigo-300{% else %}text-slate-500 dark:text-slate-400{% endif %}" {% if active_nav == 'voice-conversion' %}style="font-variation-settings: 'FILL' 1;"{% endif %}>swap_horiz</span>
            <span class="text-sm font-semibold {% if active_nav == 'voice-conversion' %}font-bold{% endif %}">Voice Conversion</span>
        </a>
        
        <!-- Vocal Removal Link -->
        <a class="flex items-center gap-4 px-5 py-3.5 rounded-xl transition-all duration-300 {% if active_nav == 'vocal-removal' %}bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 text-indigo-600 dark:text-indigo-300 border-l-4 border-indigo-500 shadow-sm{% else %}text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-slate-900 dark:hover:text-white hover:translate-x-1 hover:shadow-md{% endif %}" href="/vocal-removal">
            <span class="material-symbols-outlined text-xl {% if active_nav == 'vocal-removal' %}text-indigo-600 dark:text-indigo-300{% else %}text-slate-500 dark:text-slate-400{% endif %}" {% if active_nav == 'vocal-removal' %}style="font-variation-settings: 'FILL' 1;"{% endif %}>cut</span>
            <span class="text-sm font-semibold {% if active_nav == 'vocal-removal' %}font-bold{% endif %}">Vocal Removal</span>
        </a>
        
        <!-- Divider -->
        <div class="h-px bg-gradient-to-r from-transparent via-slate-200 to-transparent dark:via-slate-700 my-6 mx-5"></div>
        
        <!-- Playlists Section -->
        <div class="px-5 py-3">
            <h3 class="text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-widest mb-4">Your Playlists</h3>
            <div class="flex flex-col gap-3">
                <a class="flex items-center gap-3.5 text-slate-600 dark:text-slate-300 hover:text-indigo-600 dark:hover:text-indigo-300 text-sm transition-all duration-300 px-3 py-2.5 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 hover:translate-x-1 group" href="#">
                    <span class="material-symbols-outlined text-lg group-hover:scale-110 transition-transform">queue_music</span>
                    <span class="font-medium">Cyberpunk Vibes</span>
                </a>
                <a class="flex items-center gap-3.5 text-slate-600 dark:text-slate-300 hover:text-indigo-600 dark:hover:text-indigo-300 text-sm transition-all duration-300 px-3 py-2.5 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 hover:translate-x-1 group" href="#">
                    <span class="material-symbols-outlined text-lg group-hover:scale-110 transition-transform">queue_music</span>
                    <span class="font-medium">Lo-Fi Study</span>
                </a>
            </div>
        </div>
    </nav>
    
    <!-- Bottom Section -->
    <div class="p-6 border-t border-slate-200 dark:border-slate-800 bg-gradient-to-t from-slate-50 to-white dark:from-slate-900 dark:to-slate-950">
        <!-- Upgrade Button -->
        <button class="flex w-full items-center justify-center gap-3 rounded-xl py-3.5 px-5 bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 transition-all duration-300 shadow-lg shadow-indigo-500/30 hover:shadow-indigo-500/50 mb-6 group">
            <span class="material-symbols-outlined text-white text-lg group-hover:scale-110 transition-transform">diamond</span>
            <span class="text-white text-sm font-bold">Upgrade to Pro</span>
        </button>
        
        <!-- User Section -->
        <div class="flex items-center gap-4">
            {% if current_user.is_authenticated %}
            <!-- Authenticated User -->
            <div class="bg-gradient-to-br from-indigo-400 to-purple-500 rounded-full size-12 flex items-center justify-center shadow-lg ring-2 ring-white/20 dark:ring-slate-800/50" data-alt="User avatar">
                <span class="material-symbols-outlined text-white text-lg">person</span>
            </div>
            <div class="flex flex-col overflow-hidden flex-1">
                <p class="text-slate-900 dark:text-white text-sm font-semibold truncate">{{ current_user.display_name or current_user.email }}</p>
                <p class="text-slate-500 dark:text-slate-400 text-xs truncate">
                    {% if current_user.email_verified %}
                    <span class="text-green-600 dark:text-green-400 font-medium">âœ“ Verified</span>
                    {% else %}
                    <span class="text-amber-600 dark:text-amber-400 font-medium">Unverified</span>
                    {% endif %}
                </p>
            </div>
            <a href="{{ url_for('auth.profile') }}" class="text-slate-500 dark:text-slate-400 hover:text-indigo-600 dark:hover:text-indigo-300 transition-colors" title="Profile">
                <span class="material-symbols-outlined text-lg">settings</span>
            </a>
            {% else %}
            <!-- Not Authenticated -->
            <div class="bg-gradient-to-br from-slate-400 to-slate-500 rounded-full size-12 flex items-center justify-center shadow-lg ring-2 ring-white/20 dark:ring-slate-800/50">
                <span class="material-symbols-outlined text-white text-lg">person</span>
            </div>
            <div class="flex flex-col overflow-hidden flex-1">
                <p class="text-slate-900 dark:text-white text-sm font-semibold truncate">Guest User</p>
                <p class="text-slate-500 dark:text-slate-400 text-xs truncate">Not signed in</p>
            </div>
            <div class="flex gap-2">
                <a href="{{ url_for('auth.login') }}" class="text-xs text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 font-semibold px-3 py-1.5 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/30 transition-colors">Login</a>
                <a href="{{ url_for('auth.register') }}" class="text-xs bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-3 py-1.5 rounded-lg transition-colors">Register</a>
            </div>
            {% endif %}
        </div>
        
        {% if current_user.is_authenticated %}
        <div class="mt-5 pt-4 border-t border-slate-200 dark:border-slate-800">
            <a href="{{ url_for('auth.logout') }}" class="flex items-center gap-3 text-sm text-slate-600 dark:text-slate-400 hover:text-red-600 dark:hover:text-red-400 transition-colors px-3 py-2 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 group">
                <span class="material-symbols-outlined text-base group-hover:scale-110 transition-transform">logout</span>
                <span class="font-medium">Logout</span>
            </a>
        </div>
        {% endif %}
    </div>
</aside>